<html>

<head>
<script src="TDA.js"></script>
<script src="plotly.min.js"></script>
<script src="ripser/ripser.js"></script>

</head>
<table>
<tr><td><h3>Distance Cutoff</h3></td><td><input type="text" id = "dcutoff" size="5"></input></td></tr>
<tr><td><h3>Max Homological Dimension</h3></td><td><input type="text" id = "homdim" size="5"></input></td></tr>
<tr><td><h3>Point Cloud File</h3></td><td><input type="file" id="pcInput"></td></tr>
</table>

<p id = "time"></p>

<p id = "H0"></p>
<p id = "H1"></p>
<p id = "H2"></p>
<p id = "H3"></p>




<script>
    document.getElementById("dcutoff").value = "100";
    document.getElementById("homdim").value = "1";

    var fileInput = document.getElementById('pcInput');
    
	fileInput.addEventListener('change', function(e) {
		var file = fileInput.files[0];
		var textType = /text.*/;

		if (file.type.match(textType)) {
			var reader = new FileReader();
			reader.onload = function(e) {
				//console.log(reader.result);
				var lines = reader.result.split(/[\r\n]+/g);
				var Ps = [];
				for (var i = 0; i < lines.length; i++) {
				    if (lines[i].length == 0) {
				        break;
				    }
				    fields = lines[i].split(" ");
				    for (var k = 0; k < fields.length; k++) {
				        fields[k] = parseFloat(fields[k]);
				    }
				    Ps.push(fields);
				}
				var cutoff = parseFloat(document.getElementById("dcutoff").value);
				var homdim = parseInt(document.getElementById("homdim").value);
				var ret = getRipsDGMs(Ps, cutoff, homdim);
				var dgms = ret.dgms;
				var elapsed = ret.elapsed;
				document.getElementById("time").innerHTML = "Elapsed Time: " + elapsed + " seconds";
				for (var i = 0; i < dgms.length; i++) {
				    var dgmPoints = {x:dgms[i].births, y:dgms[i].deaths, mode:'markers', name:'points'};
				    var axMin = Math.min(Math.min.apply(null, dgms[i].births), Math.min.apply(null, dgms[i].deaths));
                    var axMax = Math.max(Math.max.apply(null, dgms[i].births), Math.max.apply(null, dgms[i].deaths));
                    var axRange = axMax - axMin;
				    var diagonal = {x:[axMin-axRange/5, axMax+axRange/5], y:[axMin-axRange/5, axMax+axRange/5], mode:'scatter', name:'diagonal'};
				    var layout = {title:'H'+i};
				    Plotly.newPlot('H'+i, [dgmPoints, diagonal], layout);
				}
			}
			reader.readAsText(file);	
		} else {
			result.innerHTML = "File not supported!"
		}
	});
</script>


</body>
</html>
